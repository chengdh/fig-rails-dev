= render "search"
%table#safety_table.table.table-bordered.table-hover.table-condensed.table-stripped{:style => "text-align: center;vertical-align : middle;"}
  %thead
    %tr
      %th{:rowspan => 3} 管辖单位
      %th{:colspan => 4} 安全检查
      %th{:colspan => 3} 隐患整改
      %th{:colspan => 7} 安全教育
      %th{:colspan => 6} 安保投入(万元)
      %th{:colspan => 3} 专题安全会议
      %th{:rowspan => 3} 操作
    %tr
      %th{:rowspan => 2} 次数
      %th{:colspan => 3} 其中
      %th{:rowspan => 2} 查出隐患处数
      %th{:rowspan => 2} 已整改处数
      %th{:rowspan => 2} 整改率(%) 
      %th{:colspan => 2} 三级教育
      %th{:colspan => 2} 特种工教育
      %th{:colspan => 3} 全员教育
      %th{:rowspan => 2} 总金额
      %th{:colspan => 5} 其中
      %th{:rowspan => 2}  次数
      %th{:rowspan => 2}  参加人数
      %th{:rowspan => 2}  解决问题数
    %tr
      %th 安全检查
      %th 专题检查
      %th 夜间抽查

      %th 参加人数
      %th 占应参加人数

      %th 参加人数
      %th 占应参加人数

      %th 人次
      %th 不重复人数
      %th 占全员(%)


      %th 购置器材
      %th 安保设施
      %th 隐患整改
      %th 安保教育
      %th 安保奖励
    %tbody
      - collection.each do |t|
        %tr
          %td= t.org
          %td= t.sum_safety_check_count
          %td= t.safety_check_count
          %td= t.special_safety_check_count
          %td= t.evening_safety_check_count

          %td= t.danger_count
          %td= t.fixed_danger_count
          %td= t.fixed_danger_rate

          %td= t.third_edu_persons
          %td= t.third_edu_percent

          %td= t.special_worker_edu_persons
          %td= t.special_worker_edu_percent

          %td= t.common_edu_persons
          %td= t.no_duplicate_persons
          %td= t.common_edu_percent

          %td= t.sum_invest
          %td= t.invest_equipment_money
          %td= t.invest_faclities_money
          %td= t.fixed_danger_money
          %td= t.safety_edu_money
          %td= t.safety_reward_money

          %td= t.safety_meeting_count
          %td= t.safety_meeting_persons
          %td= t.safety_meeting_solve_questions
          %td
            = link_to  resource_path(t),
              :class => "btn btn-sm btn-default",
              "data-toggle" => "tooltip",
              "data-placement" => "top",
              :title => "查看详细信息" do
              %i.fa.fa-eye

            - if can? :update,t
              = link_to edit_resource_path(t),
                :class => "btn btn-sm btn-default",
                "data-toggle" => "tooltip",
                "data-placement" => "top",
                :title => "修改当前记录" do
                %i.fa.fa-edit

            - if can? :destroy,t
              = link_to t,:method => :delete,
                "data-confirm" => "你确定要删除吗?",
                :class => "btn btn-default btn-sm",
                "data-toggle" => "tooltip",
                "data-placement" => "top",
                :title => "删除该记录" do
                %i.fa.fa-trash

    %tfoot{:style => "font-weight : bold;color :red;"}
      %tr
        %td 本月合计
        %td= @q.result.sum("safety_check_count + special_safety_check_count + evening_safety_check_count")
        %td= @q.result.sum("safety_check_count")
        %td= @q.result.sum("special_safety_check_count")
        %td= @q.result.sum("evening_safety_check_count")
        %td= @q.result.sum("danger_count")
        %td= @q.result.sum("fixed_danger_count")
        %td= (@q.result.sum("fixed_danger_count").to_f/@q.result.sum("danger_count").to_f).round(3)*100

        %td= @q.result.sum("third_edu_persons")
        %td= "#{SafetyTable.third_edu_percent(@q)}%"

        %td= @q.result.sum("special_worker_edu_persons")
        %td= "#{SafetyTable.special_worker_edu_percent(@q)}%"

        %td= @q.result.sum("common_edu_persons")
        %td= @q.result.sum("no_duplicate_persons")
        %td= "#{SafetyTable.common_edu_percent(@q)}%"

        %td= @q.result.sum("invest_equipment_money + invest_faclities_money + fixed_danger_money + safety_edu_money + safety_reward_money")
        %td= @q.result.sum("invest_equipment_money")
        %td= @q.result.sum("invest_faclities_money")
        %td= @q.result.sum("fixed_danger_money")
        %td= @q.result.sum("safety_edu_money")
        %td= @q.result.sum("safety_reward_money")

        %td= @q.result.sum("safety_meeting_count")
        %td= @q.result.sum("safety_meeting_persons")
        %td= @q.result.sum("safety_meeting_solve_questions")
        %td


= will_paginate collection, renderer: BootstrapPagination::Rails,previous_label: t("previous"), next_label: t("next")
